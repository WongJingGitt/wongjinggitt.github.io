<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥å…·å¯¼èˆª</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
            --danger-gradient: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-card: #2a2a2a;
            --bg-glass: rgba(255, 255, 255, 0.05);
            --border-glass: rgba(255, 255, 255, 0.1);
            
            --text-primary: #e0e0ff; /* [ä¼˜åŒ–] ä»çº¯ç™½æ”¹ä¸ºå¸¦è‰²è°ƒçš„äº®è‰² */
            --text-secondary: #b4b4b4;
            --text-muted: #6b7280;
            
            --glow-primary: 0 0 20px rgba(102, 126, 234, 0.3);
            --glow-secondary: 0 0 20px rgba(240, 147, 251, 0.3);
            --glow-success: 0 0 20px rgba(79, 172, 254, 0.3);
            
            --border-radius: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--bg-primary);
            color: var(--text-primary);
            text-shadow: 0 0 5px rgba(180, 180, 255, 0.1); /* [ä¼˜åŒ–] å…¨å±€æ–‡å­—è¾‰å…‰/é˜´å½± */
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        /* åŠ¨æ€èƒŒæ™¯ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            z-index: -1;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-gradient);
            border-radius: 4px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* å¤´éƒ¨åŒºåŸŸ */
        .header {
            text-align: center;
            padding: 40px 0 60px;
            position: relative;
        }

        .header h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            position: relative;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin-bottom: 32px;
        }

        .add-btn {
            background: var(--primary-gradient);
            border: none;
            padding: 16px 32px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--glow-primary);
            position: relative;
            overflow: hidden;
        }

        .add-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .add-btn:hover::before {
            left: 100%;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* æœç´¢æ  */
        .search-section {
            margin-bottom: 40px;
            text-align: center;
        }

        .search-box {
            position: relative;
            max-width: 500px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%;
            padding: 16px 24px 16px 60px;
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            font-size: 1rem;
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: var(--glow-primary);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 1.2rem;
        }

        /* åˆ†ç±»æ ‡ç­¾ */
        .filter-tags {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 24px 0;
            flex-wrap: wrap;
        }

        .filter-tag {
            padding: 8px 16px;
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: 24px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .filter-tag:hover,
        .filter-tag.active {
            background: var(--primary-gradient);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--glow-primary);
        }

        /* å·¥å…·ç½‘æ ¼ */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 60px;
        }

        .tool-card {
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: var(--border-radius);
            padding: 24px;
            text-decoration: none;
            color: var(--text-primary);
            transition: var(--transition);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 160px;
        }

        .tool-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .tool-card:hover::before {
            transform: scaleX(1);
        }

        .tool-card:hover {
            transform: translateY(-8px);
            border-color: rgba(102, 126, 234, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), var(--glow-primary);
        }

        .tool-name {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .tool-category {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .tool-description {
            font-size: 0.95rem;
            color: var(--text-secondary);
            flex-grow: 1;
            line-height: 1.5;
        }
        
        .tool-content-link {
            text-decoration: none;
            color: inherit;
            display: block;
            flex-grow: 1;
        }

        .tool-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-glass);
        }

        .tool-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .tool-btn-edit {
            background: var(--warning-gradient);
            color: white;
        }

        .tool-btn-delete {
            background: var(--danger-gradient);
            color: white;
        }

        .tool-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* æ¨¡æ€æ¡† */
        #tool-modal {
            background: var(--bg-card);
            border: 1px solid var(--border-glass);
            border-radius: var(--border-radius);
            padding: 32px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
            margin: auto; /* [ä¼˜åŒ–] å®ç°æ¨¡æ€æ¡†å‚ç›´å’Œæ°´å¹³å±…ä¸­ */
        }

        #tool-modal::backdrop {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 24px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .form-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        textarea.form-input {
            min-height: 80px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-btn-primary {
            background: var(--primary-gradient);
            color: white;
        }
        
        .modal-btn-primary:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
        }

        .modal-btn-secondary {
            background: var(--bg-glass);
            color: var(--text-secondary);
            border: 1px solid var(--border-glass);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 60px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--bg-glass);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .filter-tags {
                gap: 8px;
            }
            
            #tool-modal {
                padding: 24px;
                margin: 20px auto; /* åœ¨å°å±å¹•ä¸Šä¿æŒä¸Šä¸‹è¾¹è·ï¼ŒåŒæ—¶æ°´å¹³å±…ä¸­ */
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 24px 0 40px;
            }
            
            .tool-actions {
                flex-direction: column;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }

        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .scale-in {
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>å·¥å…·å¯¼èˆª</h1>
            <button id="add-tool-btn" class="add-btn">
                âœ¨ æ·»åŠ æ–°å·¥å…·
            </button>
        </header>

        <section class="search-section">
            <div class="search-box">
                <span class="search-icon">ğŸ”</span>
                <input type="text" id="search-input" class="search-input" placeholder="æœç´¢å·¥å…·...">
            </div>
            <div class="filter-tags" id="filter-tags">
                <span class="filter-tag active" data-category="all">å…¨éƒ¨</span>
            </div>
        </section>

        <main id="navigation-container">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </main>
    </div>

    <dialog id="tool-modal">
        <h2 class="modal-title" id="modal-title">æ·»åŠ æ–°å·¥å…·</h2>
        <form id="tool-form">
            <input type="hidden" id="tool-id">
            
            <div class="form-group">
                <label for="tool-name">å·¥å…·åç§°</label>
                <input type="text" id="tool-name" class="form-input" name="name" required placeholder="è¾“å…¥å·¥å…·åç§°">
            </div>
            
            <div class="form-group">
                <label for="tool-url">å·¥å…·é“¾æ¥</label>
                <input type="url" id="tool-url" class="form-input" name="url" required placeholder="https://example.com">
            </div>
            
            <div class="form-group">
                <label for="tool-type">åˆ†ç±»</label>
                <input type="text" id="tool-type" class="form-input" name="type" required placeholder="ä¾‹å¦‚: å¼€å‘å·¥å…·">
            </div>
            
            <div class="form-group">
                <label for="tool-index">æ’åºæƒé‡</label>
                <input type="number" id="tool-index" class="form-input" name="index" value="9999" title="æ•°å­—è¶Šå°ï¼Œåˆ†ç±»è¶Šé å‰">
            </div>
            
            <div class="form-group">
                <label for="tool-info">å·¥å…·æè¿°</label>
                <textarea id="tool-info" class="form-input" name="info" placeholder="ç®€å•æè¿°è¿™ä¸ªå·¥å…·çš„ç”¨é€”..."></textarea>
            </div>
            
            <div class="form-actions">
                <button type="button" id="cancel-btn" class="modal-btn modal-btn-secondary">å–æ¶ˆ</button>
                <button type="submit" class="modal-btn modal-btn-primary">ä¿å­˜</button>
            </div>
        </form>
    </dialog>

    <script>
        // é…ç½®
        const API_ENDPOINT = `https://wongjinggitt.github.io/public/tool_list.json?_v=${new Date().getTime()}`;
        const DB_NAME = 'userToolsDB';
        const DB_VERSION = 1;
        const STORE_NAME = 'tools';
        const DEFAULT_CATEGORY_INDEX = 9999;

        // DOM å…ƒç´ 
        const navigationContainer = document.getElementById('navigation-container');
        const addToolBtn = document.getElementById('add-tool-btn');
        const toolModal = document.getElementById('tool-modal');
        const toolForm = document.getElementById('tool-form');
        const cancelBtn = document.getElementById('cancel-btn');
        const modalTitle = document.getElementById('modal-title');
        const toolIdInput = document.getElementById('tool-id');
        const searchInput = document.getElementById('search-input');
        const filterTags = document.getElementById('filter-tags');

        // å…¨å±€çŠ¶æ€
        let allTools = [];
        let filteredTools = [];
        let currentFilter = 'all';
        let db;

        // IndexedDB æ“ä½œ
        async function dbSetup() {
            return new Promise((resolve, reject) => {
                if (db) { resolve(db); return; }
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                request.onerror = (event) => {
                    console.error("IndexedDB error:", event.target.error);
                    reject("Database error: " + event.target.error);
                };
                request.onsuccess = (event) => {
                    db = event.target.result;
                    resolve(db);
                };
                request.onupgradeneeded = (event) => {
                    const dbInstance = event.target.result;
                    if (!dbInstance.objectStoreNames.contains(STORE_NAME)) {
                        const store = dbInstance.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                    }
                };
            });
        }

        async function addLocalTool(tool) {
            await dbSetup();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                delete tool.id;
                const request = store.add(tool);
                request.onsuccess = (event) => resolve(event.target.result);
                request.onerror = (event) => reject("Error adding tool: " + event.target.error);
            });
        }

        async function updateLocalTool(tool) {
            await dbSetup();
            return new Promise((resolve, reject) => {
                if (!tool.id) return reject("Cannot update tool without an ID.");
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.put(tool);
                request.onsuccess = () => resolve();
                request.onerror = (event) => reject("Error updating tool: " + event.target.error);
            });
        }

        async function deleteLocalTool(id) {
            await dbSetup();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.delete(id);
                request.onsuccess = () => resolve();
                request.onerror = (event) => reject("Error deleting tool: " + event.target.error);
            });
        }

        async function getAllLocalTools() {
            await dbSetup();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.getAll();
                request.onsuccess = (event) => {
                    const localTools = event.target.result.map(tool => ({
                        ...tool,
                        index: Number(tool.index),
                        isLocal: true
                    }));
                    resolve(localTools);
                };
                request.onerror = (event) => reject("Error getting tools: " + event.target.error);
            });
        }

        // [ä¼˜åŒ–] é‡æ„æ•°æ®åˆå¹¶ä¸æ’åºé€»è¾‘ï¼Œç¡®ä¿æœ¬åœ°å·¥å…·ä¼˜å…ˆ
        async function fetchAndRenderTools() {
            try {
                // 1. è·å–å¹¶å¤„ç† API å·¥å…·
                let apiTools = [];
                try {
                    const response = await fetch(API_ENDPOINT);
                    if (response.ok) {
                        const apiGroupedData = await response.json() || {};
                        Object.entries(apiGroupedData).forEach(([type, groupData]) => {
                            if (groupData.tools && groupData.tools.length > 0) {
                                groupData.tools.forEach(tool => {
                                    apiTools.push({
                                        ...tool,
                                        type: type,
                                        category: type,
                                        index: Number(groupData.index) || DEFAULT_CATEGORY_INDEX,
                                        isLocal: false // æ˜ç¡®æ ‡è®°ä¸ºéæœ¬åœ°
                                    });
                                });
                            }
                        });
                    }
                } catch (apiError) {
                    console.warn("Failed to fetch from API, proceeding with local data only.", apiError);
                }

                // 2. è·å–æœ¬åœ°å·¥å…·
                let localTools = [];
                try {
                    localTools = await getAllLocalTools(); // isLocal: true å·²åœ¨å†…éƒ¨è®¾ç½®
                } catch (dbError) {
                    console.error("Failed to fetch from IndexedDB.", dbError);
                }
                
                // 3. åˆ†åˆ«æ’åºï¼Œç„¶ååˆå¹¶
                localTools.sort((a, b) => a.name.localeCompare(b.name, 'zh-CN'));
                apiTools.sort((a, b) => a.name.localeCompare(b.name, 'zh-CN'));

                allTools = [...localTools, ...apiTools]; // æœ¬åœ°å·¥å…·åœ¨å‰ï¼ŒAPIå·¥å…·åœ¨å

                // åç»­æµç¨‹ä¸å˜
                updateFilterTags();
                filterTools(currentFilter, searchInput.value.trim());

            } catch (error) {
                console.error('è·å–å·¥å…·æ•°æ®æ—¶å‡ºé”™:', error);
                navigationContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">âŒ</div>
                        <p>åŠ è½½å·¥å…·åˆ—è¡¨å¤±è´¥: ${error.message || error}</p>
                    </div>
                `;
            }
        }

        // æ›´æ–°è¿‡æ»¤å™¨æ ‡ç­¾
        function updateFilterTags() {
            const categoriesData = allTools.reduce((acc, tool) => {
                const category = tool.category;
                if (!acc[category]) {
                    acc[category] = { count: 0, index: Infinity };
                }
                acc[category].count++;
                
                const toolIndex = Number(tool.index);
                if (!isNaN(toolIndex) && toolIndex < acc[category].index) {
                     acc[category].index = toolIndex;
                }
                return acc;
            }, {});

            const sortedCategories = Object.keys(categoriesData).sort((a, b) => {
                const indexA = categoriesData[a].index;
                const indexB = categoriesData[b].index;
                if (indexA !== indexB) return indexA - indexB;
                return a.localeCompare(b, 'zh-CN');
            });

            filterTags.innerHTML = `<span class="filter-tag" data-category="all">å…¨éƒ¨ (${allTools.length})</span>`;
            
            sortedCategories.forEach(category => {
                const count = categoriesData[category].count;
                const tag = document.createElement('span');
                tag.className = 'filter-tag';
                tag.dataset.category = category;
                tag.textContent = `${category} (${count})`;
                filterTags.appendChild(tag);
            });
            
            const activeTag = filterTags.querySelector(`[data-category="${currentFilter}"]`);
            if(activeTag) activeTag.classList.add('active');
        }

        // è¿‡æ»¤å·¥å…·
        function filterTools(category, searchTerm = '') {
            currentFilter = category;
            
            let tempFiltered = (category === 'all')
                ? [...allTools]
                : allTools.filter(tool => tool.category === category);
            
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                tempFiltered = tempFiltered.filter(tool => 
                    tool.name.toLowerCase().includes(term) ||
                    (tool.info && tool.info.toLowerCase().includes(term)) ||
                    tool.category.toLowerCase().includes(term)
                );
            }
            
            filteredTools = tempFiltered;
            renderTools();

            document.querySelectorAll('.filter-tag').forEach(tag => {
                tag.classList.toggle('active', tag.dataset.category === currentFilter);
            });
        }

        // æ¸²æŸ“å·¥å…·
        function renderTools() {
            if (filteredTools.length === 0) {
                navigationContainer.innerHTML = `
                    <div class="empty-state fade-in">
                        <div class="empty-icon">ğŸ§</div>
                        <p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å·¥å…·</p>
                    </div>
                `;
                return;
            }

            const toolsGrid = document.createElement('div');
            toolsGrid.className = 'tools-grid fade-in';

            filteredTools.forEach(tool => {
                const toolCard = document.createElement('div');
                toolCard.className = 'tool-card scale-in';
                
                const toolContentLink = document.createElement('a');
                toolContentLink.href = tool.url;
                toolContentLink.target = '_blank';
                toolContentLink.rel = 'noopener noreferrer';
                toolContentLink.className = 'tool-content-link';
                
                toolContentLink.innerHTML = `
                    <div class="tool-name">${tool.name}</div>
                    <div class="tool-category">${tool.type}</div>
                    <div class="tool-description">${tool.info || 'æš‚æ— æè¿°'}</div>
                `;

                toolCard.appendChild(toolContentLink);

                if (tool.isLocal) {
                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'tool-actions';
                    
                    const editBtn = document.createElement('button');
                    editBtn.className = 'tool-btn tool-btn-edit';
                    editBtn.innerHTML = 'âœï¸ ç¼–è¾‘';
                    editBtn.onclick = (e) => {
                        e.preventDefault();
                        editTool(tool);
                    };
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'tool-btn tool-btn-delete';
                    deleteBtn.innerHTML = 'ğŸ—‘ï¸ åˆ é™¤';
                    deleteBtn.onclick = (e) => {
                        e.preventDefault();
                        deleteTool(tool);
                    };
                    
                    actionsDiv.appendChild(editBtn);
                    actionsDiv.appendChild(deleteBtn);
                    toolCard.appendChild(actionsDiv);
                }

                toolsGrid.appendChild(toolCard);
            });

            navigationContainer.innerHTML = '';
            navigationContainer.appendChild(toolsGrid);
        }

        // ç¼–è¾‘å·¥å…·
        function editTool(tool) {
            modalTitle.textContent = "ç¼–è¾‘å·¥å…·";
            toolForm.reset();
            toolIdInput.value = tool.id;
            document.getElementById('tool-name').value = tool.name;
            document.getElementById('tool-url').value = tool.url;
            document.getElementById('tool-type').value = tool.type;
            document.getElementById('tool-index').value = tool.index || DEFAULT_CATEGORY_INDEX;
            document.getElementById('tool-info').value = tool.info || '';
            toolModal.showModal();
        }

        // åˆ é™¤å·¥å…·
        async function deleteTool(tool) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤å·¥å…· "${tool.name}" å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚`)) {
                try {
                    await deleteLocalTool(tool.id);
                    await fetchAndRenderTools();
                } catch (error) {
                    console.error('Error deleting tool:', error);
                    alert('åˆ é™¤å·¥å…·å¤±è´¥: ' + error.message);
                }
            }
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchAndRenderTools();

            addToolBtn.addEventListener('click', () => {
                modalTitle.textContent = "æ·»åŠ æ–°å·¥å…·";
                toolForm.reset();
                toolIdInput.value = '';
                document.getElementById('tool-index').value = DEFAULT_CATEGORY_INDEX;
                toolModal.showModal();
            });

            toolForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = new FormData(toolForm);
                const toolData = {
                    name: formData.get('name').trim(),
                    url: formData.get('url').trim(),
                    type: formData.get('type').trim(),
                    index: Number(formData.get('index')) || DEFAULT_CATEGORY_INDEX,
                    info: formData.get('info').trim(),
                    isLocal: true
                };

                if (!toolData.name || !toolData.url || !toolData.type) {
                    alert('å·¥å…·åç§°ã€é“¾æ¥å’Œåˆ†ç±»æ˜¯å¿…å¡«é¡¹ã€‚');
                    return;
                }

                const id = toolIdInput.value;
                const submitButton = toolForm.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.textContent = 'ä¿å­˜ä¸­...';

                try {
                    if (id) {
                        toolData.id = parseInt(id, 10);
                        await updateLocalTool(toolData);
                    } else {
                        await addLocalTool(toolData);
                    }
                    toolModal.close();
                    await fetchAndRenderTools();
                } catch (error) {
                    console.error('Error saving tool:', error);
                    alert('ä¿å­˜å·¥å…·å¤±è´¥: ' + error.message);
                } finally {
                    submitButton.disabled = false;
                    submitButton.textContent = 'ä¿å­˜';
                }
            });

            cancelBtn.addEventListener('click', () => {
                toolModal.close();
            });

            toolModal.addEventListener('click', (event) => {
                if (event.target === toolModal) {
                    toolModal.close();
                }
            });

            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const searchTerm = e.target.value.trim();
                    filterTools(currentFilter, searchTerm);
                }, 250); // Debounce input
            });

            filterTags.addEventListener('click', (e) => {
                if (e.target.classList.contains('filter-tag')) {
                    const category = e.target.dataset.category;
                    const searchTerm = searchInput.value.trim();
                    filterTools(category, searchTerm);
                }
            });
        });

    </script>
</body>
</html>